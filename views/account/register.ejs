<!--views/account/register.ejs-->
<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('../partials/head') %>
  </head>
  <body class="checkerboard">
    <a class="skip-link" href="#main">Skip to content</a>

    <div class="page">
      <%- include('../partials/brandbar') %>
      <%- include('../partials/navigation') %>

      <main id="main" class="container main-content register-screen">
        <h1 class="page-title"><%= title %></h1>

        <!-- Flash messages -->
<% if (typeof messages === 'function') { %>
  <%- messages() %>
<% } %>

<!-- One-time error helpers (define ONCE) -->
<%
  const hasErrors = (typeof errors !== 'undefined' && errors && Object.keys(errors).length > 0);
  const fieldErrors = hasErrors ? errors : {};
%>

<!-- Summary list -->
<% if (hasErrors) { %>
  <ul class="notice">
    <% Object.values(fieldErrors).forEach(err => { %>
      <li><%= err.msg %></li>
    <% }) %>
  </ul>
<% } %>

<section class="register-card">
  <form action="/account/register" method="post" class="register-form">
    <div class="form-row">
      <% const fnErr  = fieldErrors && fieldErrors.account_firstname; %>
      <label for="account_firstname">First name</label>
      <input
        id="account_firstname"
        name="account_firstname"
        type="text"
        required
        minlength="2"
        pattern="^[A-Za-z][A-Za-z' -]*$"
        title="Only letters, apostrophes (’), spaces, and hyphens; must start with a letter."
        <%= fnErr ? 'aria-invalid="true"' : '' %>
        aria-describedby="<%= fnErr ? 'firstHelp err_firstname' : 'firstHelp' %>"
        value="<%= typeof account_firstname !== 'undefined' ? account_firstname : '' %>">
      <small id="firstHelp" class="help">Letters, apostrophes, spaces, and hyphens only.</small>
      <% if (fnErr) { %><div class="field-error" id="err_firstname" role="alert"><%= fieldErrors.account_firstname.msg %></div><% } %>
    </div>

    <div class="form-row">
      <% const lnErr  = fieldErrors && fieldErrors.account_lastname; %>
      <label for="account_lastname">Last name</label>
      <input
        id="account_lastname"
        name="account_lastname"
        type="text"
        required
        minlength="2"
        pattern="^[A-Za-z][A-Za-z' -]*$"
        title="Only letters, apostrophes (’), spaces, and hyphens; must start with a letter."
        <%= lnErr ? 'aria-invalid="true"' : '' %>
        aria-describedby="<%= lnErr ? 'lastHelp err_lastname' : 'lastHelp' %>"
        value="<%= typeof account_lastname !== 'undefined' ? account_lastname : '' %>">
      <small id="lastHelp" class="help">Letters, apostrophes, spaces, and hyphens only.</small>
      <% if (lnErr) { %><div class="field-error" id="err_lastname" role="alert"><%= fieldErrors.account_lastname.msg %></div><% } %>
    </div>

    <div class="form-row">
      <% const emErr  = fieldErrors && fieldErrors.account_email; %>
      <label for="account_email">Email address</label>
      <input
        id="account_email"
        name="account_email"
        type="email"
        required
        autocomplete="email"
        inputmode="email"
        <%= emErr ? 'aria-invalid="true"' : '' %>
        aria-describedby="<%= emErr ? 'regEmailHelp err_email' : 'regEmailHelp' %>"
        value="<%= typeof account_email !== 'undefined' ? account_email : '' %>">
      <small id="regEmailHelp" class="help">We’ll send account info to this address.</small>
      <% if (emErr) { %><div class="field-error" id="err_email" role="alert"><%= fieldErrors.account_email.msg %></div><% } %>
    </div>

    <div class="form-row">
      <% const pwErr = fieldErrors && fieldErrors.account_password; %>
      <label for="account_password">Password</label>
      <div class="password-input">
      <input
        id="account_password"
        name="account_password"
        type="password"
        required
        minlength="12"
        autocomplete="new-password"
        pattern="(?=.*[A-Z])(?=.*\\d)(?=.*[^A-Za-z0-9]).{12,}"
        <%= pwErr ? 'aria-invalid="true"' : '' %>
        aria-describedby="<%= pwErr ? 'pwHelp err_password' : 'pwHelp' %>">
      <button type="button" id="togglePassword" class="btn-secondary" aria-pressed="false" aria-controls="account_password">Show</button>
    </div>
    <small id="pwHelp" class="help">
      At least 12 chars, with an uppercase letter, a number, and a symbol.
    </small>
    <% if (pwErr) { %>
      <div class="field-error" id="err_password" role="alert"><%= fieldErrors.account_password.msg %></div>
    <% } %>
    </div>

    <button type="submit" class="btn-register">Register</button>
  </form>
</section>

      </main>

      <%- include('../partials/footer') %>
    </div>

    <script>
      // Password show/hide toggle
      (function () {
        const input = document.getElementById('account_password');
        const btn = document.getElementById('togglePassword');
        if (!input || !btn) return;
        btn.addEventListener('click', () => {
          const isPwd = input.type === 'password';
          input.type = isPwd ? 'text' : 'password';
          btn.textContent = isPwd ? 'Hide' : 'Show';
          btn.setAttribute('aria-pressed', String(isPwd));
        });
      }());
    </script>
    
    <script>
      //Validates name and last name entry
  (function () {
    function filterName(el){
      // Keep letters, apostrophe, space, hyphen
      el.value = el.value.replace(/[^A-Za-z' -]/g, '');
    }
    ['account_firstname','account_lastname'].forEach(id => {
      const input = document.getElementById(id);
      if (!input) return;
      input.addEventListener('input', () => filterName(input));
    });
  }());
</script>

  </body>
</html>

